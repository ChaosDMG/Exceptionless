<script lang="ts">
	import * as Avatar from '$comp/ui/avatar';

	import ErrorMessage from '$comp/ErrorMessage.svelte';
	import EmailInput from '$comp/form/EmailInput.svelte';
	import TextInput from '$comp/form/TextInput.svelte';
	import { Separator } from '$comp/ui/separator';
	import { Button } from '$comp/ui/button';
	import Loading from '$comp/Loading.svelte';

	import H3 from '$comp/typography/H3.svelte';
	import Muted from '$comp/typography/Muted.svelte';
	import { User } from '$lib/models/api.generated';
	import { ProblemDetails, globalLoading as loading } from '$lib/api/FetchClient';

	const data = new User();
	let problem = new ProblemDetails();

	async function onSave() {
		if ($loading) {
			return;
		}

		// let response = await save(data);
		// if (response.ok) {
		//     // TODO
		// } else {
		// 	problem = response.problem;
		// }
	}
</script>

<div class="space-y-6">
	<div>
		<H3>Account</H3>
		<Muted>Manage your account settings and set e-mail preferences.</Muted>
	</div>
	<Separator />

	<Avatar.Root title="TODO" class="w-24 h-24">
		<Avatar.Image
			src="//www.gravatar.com/avatar/89b10deee628535a5510db131f983541?default=mm&size=100"
			alt="gravatar"
		/>
		<Avatar.Fallback>TODO</Avatar.Fallback>
	</Avatar.Root>
	<Muted
		>Your avatar is generated by requesting a Gravatar image with the email address below.</Muted
	>

	<form on:submit|preventDefault={onSave}>
		<ErrorMessage message={problem.errors.general}></ErrorMessage>
		<TextInput
			name="full_name"
			label="Full Name"
			bind:value={data.full_name}
			autocomplete="name"
			required
			{problem}
		></TextInput>
		<EmailInput
			name="email_address"
			label="Email Address"
			bind:value={data.email_address}
			autocomplete="email"
			required
			{problem}
		></EmailInput>
		<div class="my-4">
			<Button type="submit">
				{#if $loading}
					<Loading class="mr-2" variant="secondary"></Loading> Saving...
				{:else}
					Save
				{/if}
			</Button>
		</div>
	</form>
</div>
